<!DOCTYPE html>
<html>
<head>
  <title>views - Transitive.io Manual &amp; Documentation</title>
  <link type="image/x-icon" rel="icon" href="/favicon.ico" />
  <link type="image/x-icon" rel="shortcut icon" href="/favicon.ico" />
  <link rel="stylesheet" href="assets/style.css" type="text/css" media="all" />
  <link rel="stylesheet" href="assets/sh.css" type="text/css" media="all"/>
</head>
<body>
  <div id="container">
    <header>
      <h1>Transitive.io Documentation &amp; API</h1>
      <div id="gtoc">
        <p><a href="http://transitive.io">Transitive.io</a> | <a href="index.html">Documentation Home</a> | <a href="all.html">View on single page</a></p>
      </div>
      <hr />
    </header>
    <div id="toc"><h2>Table Of Contents</h2><ul><li><a href="#views">Views</a><ul><li><a href="#templates">Templates</a><ul><li><a href="#compilation">compilation</a></li><li><a href="#engines">engines</a></li></ul></li><li><a href="#transitive.Views">Transitive.Views</a><ul><li><a href="#render">render(templateName, data)</a></li><li><a href="#renderPage">renderPage(templateName, data, layoutName)</a></li></ul></li><li><a href="#liveRender">LiveRender</a><ul><li><a href="#prepare">prepare(templateName, data)</a></li><li><a href="#update">update(event)</a></li><li><a href="#name">name</a></li></ul></li><li><a href="#renderContext">RenderContext</a><ul><li><a href="#render">render(templateName, data)</a></li><li><a href="#renderLive">renderLive(name, templateName, data)</a></li></ul></li><li><a href="#viewBinding">ViewBinding</a></li></ul></li></ul><hr /></div>
<h2 id="views">Views</h2>

<p>Views are the combination of <a href="#templates">Templates</a>, <a href="#liveRender">LiveRenders</a> and a <a href="#renderContext">RenderContext</a>.  The server compiles your <a href="#templates">Templates</a> during the <a href="boot.html">Boot</a> process.  Normally, you will create your own Templates and LiveRenders by creating files in the <a href="magic_values.html">appropriate folders</a>, and will interact with your views through <a href="#transitive.Views">Transitive.Views</a>. </p>

<h3 id="templates">Templates</h3>

<p>By default, templates reside in options.root + "/templates"</p>

<h4 id="compilation">compilation</h4>

<p>Templates are compiled by <a href="http://github.com/aaronblohowiak/shared-views">Shared-Views</a>.  Filenames are converted to template names by removing the template folder path and the file extension from the file name.  For instance, you'd render "/var/www/example.com/templates/user/profile.haml" by calling <code>render("user/profile", user)</code>.  There is <em>no support</em> for relative view names.  You may specify your own <code>filenameToTemplateName(filename)</code> function by overriding the default. </p>

<p>To override the default configuration, pass a valid Shared-Views configuration to <code>Transitive.initialize(scope, options)</code> as <code>options.sharedViewConfig</code>.</p>

<h4 id="engines">engines</h4>

<p>By default, Transitive supports <a href="http://github.com/creationix/haml-js">Haml-js</a> with <code>escapeHtmlByDefault</code> set to <code>true</code> and a custom html escaping function.</p>

<p>Engines <em>MUST</em> accept the template source and return a function that accepts a locals object and returns html.  The function will be executed with a <a href="#renderContext">RenderContext</a> as <code>this</code>.</p>

<h3 id="transitive.Views">Transitive.Views</h3>

<h4 id="render">render(templateName, data)</h4>

<p>If called on the client:</p>

<p><code>render</code> creates a RenderContext, and calls its <code>render(templateName, data)</code>.  It will return immediately with the html and set up a setTimeout() to process any new ViewBindings. </p>

<p>If called on the server:</p>

<p><code>render</code> will render <code>templateName</code> with <code>data</code>.  If <code>templateName</code> or any sub-templates (partials) call <code>renderLive</code>, an error will be thrown.  To render templates with layouts on the server, please use <code>renderPage</code>.</p>

<h4 id="renderPage">renderPage(templateName, data, layoutName)</h4>

<p>renderPage creates a new RenderContext and uses it to render templateName with data.locals.  It passes the result to </p>

<h3 id="liveRender">LiveRender</h3>

<p>By default, LiveRenders are stored in <code>options.root+"/live-renders"</code></p>

<p>Automatic updating is provided by LiveRenders.  Each LiveRender has two functions: <code>prepare</code> and <code>update</code>.  Each LiveRender must have a unique <code>name</code> property.  </p>

<p>To use a LiveRender, call <code>this.renderLive(name, templateName, data)</code> in a template.  See the <a href="#renderLive">renderLive</a> documentation.</p>

<p>Here is an example LiveRender that prepends updates to the top of a DOM element, like you might use for an activity stream or chat room. To prepare the initial html, it renders <code>templateName</code> for each item in <code>data</code> and returns the resulting html.  When an update is received, it renders <code>templateName</code> with the new item and adds this html to the top of the element.</p>

<pre><code>module.exports = {
  name: "prepend",

  prepare: function(templateName, data){
    var itemsHtml = [];

    for(var i = data.length - 1; i &gt;= 0; i--){
      itemsHtml.push(this.render(templateName, data[i]));
    }

    return itemsHtml.join();
  },

  update: function(event){
    this.element.prepend(Transitive.Views.render(this.templateName, event));
  }
}</code></pre>

<h4 id="prepare">prepare(templateName, data)</h4>

<p>called when the HTML is initially rendered.  At a minimum, you should return the rendered template with the data.  May be called on the server during the initial page load or on the client if the client calls <code>renderLive</code>.</p>

<pre><code>  prepare: function(templateName, data){
    return this.render(templateName, data);
  }</code></pre>

<p><code>this</code> is the current RenderContext.</p>

<h4 id="update">update(event)</h4>

<p>called when the server sends an event about data. modify the current page.</p>

<p><code>this</code> will be a <a href="#viewBinding">ViewBinding</a></p>

<h4 id="name">name</h4>

<p>The (unique) name of the LiveRender</p>

<h3 id="renderContext">RenderContext</h3>

<p> You should not have to create a RenderContext. It is documented here because it is <code>this</code> in a template.  If you would like to render a template and you are <strong>not</strong> already within a template, please use <code>Transitive.Views.renderPage</code> or <code>Transitive.Views.render</code> if you are on the server or the client, respectively -- these functions will create a RenderContext for you and will handle any resulting ViewBindings. </p>

<h4 id="render">render(templateName, data)</h4>

<p>renders <code>templateName</code> with the given <code>data</code>, returning HTML.</p>

<h4 id="renderLive">renderLive(name, templateName, data)</h4>

<p>Gets the LiveRender with the name of <code>name</code> and calls it's <code>prepare(templateName, data)</code> to get the content. Then, it wraps that content with a new div that has a unique id and a class of <code>name</code>. Finally, it creates a new ViewBinding and adds it to <code>this.bindings</code>.  </p>

<h3 id="viewBinding">ViewBinding</h3>

<p> ViewBindings contain the information that ties together a DOM element, a template and an event handler to a stream of events from the server.  ViewBindings are automatically added to the RenderContext's bindings array when renderLive is called.</p>

<ul><li><code>elementId</code>: id of a wrapper div automatically inserted around the output of your <code>prepare</code> function</li><li><code>templateName</code>: the same <code>templateName</code> that was passed your <code>prepare</code> function</li><li><code>objId</code>: contains the value of <code>data.id</code></li><li><code>name</code>: the name of the LiveRender that was called to create this ViewBinding.</li></ul>

<p>On the client, it will also have:</p>

<ul><li><code>element</code>: a cached <code>jQuery('#'+elementId)</code> for performance</li></ul>

<p>You should not have to create a ViewBinding.  It is documented here as it is the <code>this</code> context for a LiveRender's <code>update</code> method.
 </p>
      <hr />
      <div id="gtoc">
        <p><a href="http://transitive.io">Transitive.io</a> | <a href="index.html">Documentation Home</a> | <a href="all.html">View on single page</a></p>
      </div>
  </div>
</body>
</html>